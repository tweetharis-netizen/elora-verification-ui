"use strict";exports.id=382,exports.ids=[382],exports.modules={382:(e,r,t)=>{t.r(r),t.d(r,{default:()=>handler});async function handler(e,r){let t=(process.env.NEXT_PUBLIC_ELORA_BACKEND_URL||"https://elora-website.vercel.app").replace(/\/$/,""),i="string"==typeof e.query.token?e.query.token:"";if(!i)return r.redirect("/verify?error=invalid");try{let n=await fetch(`${t}/api/verification/confirm`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:i})}),o=await n.json().catch(()=>null);if(!n.ok||!o?.ok){let e=o?.error?String(o.error):"invalid";return r.redirect(`/verify?error=${encodeURIComponent(e)}`)}let a=o?.sessionToken||o?.sessionJwt||"";if(!a)return r.redirect("/verify?error=invalid");let s=function(e){let r=String(e||"").trim().toLowerCase();if(!r||r.startsWith("localhost"))return null;let t=r.split(".");return t.length<3?null:"vercel.app"===t.slice(-2).join(".")&&t.length>=4?"."+t.slice(-4).join("."):null}(e.headers.host);return function(e,r,t,i={}){let n=[`${r}=${encodeURIComponent(t)}`];n.push(`Path=${i.path||"/"}`),i.domain&&n.push(`Domain=${i.domain}`),void 0!==i.maxAge&&n.push(`Max-Age=${i.maxAge}`),i.httpOnly&&n.push("HttpOnly"),i.secure&&n.push("Secure"),i.sameSite&&n.push(`SameSite=${i.sameSite}`),e.setHeader("Set-Cookie",n.join("; "))}(r,"elora_session",a,{path:"/",domain:s||void 0,httpOnly:!0,secure:!0,sameSite:"Lax",maxAge:2592e3}),r.redirect(`/verified?email=${encodeURIComponent(o.email||"")}`)}catch{return r.redirect("/verify?error=backend_unreachable")}}}};