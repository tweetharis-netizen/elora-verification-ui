"use strict";exports.id=8454,exports.ids=[8454],exports.modules={8454:(t,e,a)=>{a.a(t,async(t,s)=>{try{a.d(e,{$P:()=>removeStudentFromClass,Ee:()=>addStudentToClass,e7:()=>addBehavioralNote,nW:()=>getUserClasses,qH:()=>createClass});var r=a(1492),i=a(2497),n=t([r,i]);async function createClass({teacherId:t,name:e,subject:a,level:s,description:n=""}){if(!i.db)throw Error("Firestore not initialized");let o=function(){let t="ABCDEFGHJKLMNPQRSTUVWXYZ23456789",e="";for(let a=0;a<6;a++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}(),d={teacherId:t,name:e,subject:a,level:s,description:n,joinCode:o,students:[],createdAt:(0,r.serverTimestamp)(),updatedAt:(0,r.serverTimestamp)(),seatingChart:null,attendance:{},behavioralNotes:{},settings:{allowChat:!0,moderateChat:!0,allowPeerReview:!0,allowExtensionRequests:!0}},l=(0,r.doc)((0,r.collection)(i.db,"classes"));return await (0,r.setDoc)(l,d),{id:l.id,...d}}async function getTeacherClasses(t){if(!i.db)return[];let e=(0,r.query)((0,r.collection)(i.db,"classes"),(0,r.where)("teacherId","==",t)),a=await (0,r.getDocs)(e);return a.docs.map(t=>({id:t.id,...t.data()}))}async function addStudentToClass(t,e){if(!i.db)throw Error("Firestore not initialized");let a=(0,r.doc)(i.db,"classes",t);await (0,r.updateDoc)(a,{students:(0,r.arrayUnion)({id:e.id,name:e.name,email:e.email,joinedAt:new Date().toISOString()}),updatedAt:(0,r.serverTimestamp)()})}async function removeStudentFromClass(t,e){if(!i.db)throw Error("Firestore not initialized");let a=(0,r.doc)(i.db,"classes",t),s=await (0,r.getDoc)(a);if(!s.exists())throw Error("Class not found");let n=s.data(),o=n.students.filter(t=>t.id!==e);await (0,r.updateDoc)(a,{students:o,updatedAt:(0,r.serverTimestamp)()})}async function addBehavioralNote(t,e,a){if(!i.db)throw Error("Firestore not initialized");let s=(0,r.doc)(i.db,"classes",t),n={content:a,timestamp:new Date().toISOString(),id:Date.now().toString()};await (0,r.updateDoc)(s,{[`behavioralNotes.${e}`]:(0,r.arrayUnion)(n),updatedAt:(0,r.serverTimestamp)()})}async function getStudentClasses(t){if(!i.db)return[];let e=await (0,r.getDocs)((0,r.collection)(i.db,"classes")),a=[];return e.forEach(e=>{let s=e.data(),r=s.students?.some(e=>e.id===t);r&&a.push({id:e.id,...s})}),a}async function getUserClasses(t,e,a=null){if(!i.db)return[];try{if("educator"===e)return await getTeacherClasses(t);if("student"===e)return await getStudentClasses(t);if("parent"===e&&a)return await getStudentClasses(a);return[]}catch(t){return console.error("Error in getUserClasses:",t),[]}}[r,i]=n.then?(await n)():n,s()}catch(t){s(t)}})}};