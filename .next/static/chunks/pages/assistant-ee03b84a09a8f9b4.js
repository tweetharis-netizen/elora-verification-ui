(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[229],{5973:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/assistant",function(){return a(2025)}])},8400:function(e,t,a){"use strict";a.d(t,{$K:function(){return getRecommendations},cK:function(){return getRecommendationReason}});let s={math:[{id:"v1",title:"Algebra Basics: What Is Algebra?",channel:"Math Antics",url:"https://www.youtube.com/watch?v=NybHckSEQBI",thumbnail:"https://img.youtube.com/vi/NybHckSEQBI/mqdefault.jpg",topics:["Math","Algebra","Equations","Variables"],description:"A great introduction to the fundamentals of algebraic thinking.",views:"12M",likes:"450K"},{id:"v2",title:"Introduction to equations",channel:"Khan Academy",url:"https://www.youtube.com/watch?v=vDqOoI-4Z6M",thumbnail:"https://img.youtube.com/vi/vDqOoI-4Z6M/mqdefault.jpg",topics:["Math","Equations","Linear Equations"],description:"Learn how to represent balanced relationships using math.",views:"8.5M",likes:"320K"},{id:"v_frac",title:"Introduction to Fractions",channel:"Math Antics",url:"https://www.youtube.com/watch?v=CA9XLJpQp3c",thumbnail:"https://img.youtube.com/vi/CA9XLJpQp3c/mqdefault.jpg",topics:["Math","Fractions","Numbers"],description:"What are fractions anyway? Learn the basics of numerator and denominator.",views:"15M",likes:"580K"},{id:"v_geom",title:"Intro to Geometry",channel:"Khan Academy",url:"https://www.youtube.com/watch?v=f-SUE_T0vEY",thumbnail:"https://img.youtube.com/vi/f-SUE_T0vEY/mqdefault.jpg",topics:["Math","Geometry","Shapes","Angles"],description:"Explore the language of points, lines, and planes.",views:"6.2M",likes:"210K"}],science:[{id:"v3",title:"Introduction to Cells: The Grand Cell Tour",channel:"Amoeba Sisters",url:"https://www.youtube.com/watch?v=8IlzKADrx8A",thumbnail:"https://img.youtube.com/vi/8IlzKADrx8A/mqdefault.jpg",topics:["Science","Biology","Cells","Organelles"],description:"Explore the microscopic world inside every living thing.",views:"22M",likes:"890K"},{id:"v4",title:"Newton's First Law of Motion",channel:"Crash Course",url:"https://www.youtube.com/watch?v=T1ux9D7-O38",thumbnail:"https://img.youtube.com/vi/T1ux9D7-O38/mqdefault.jpg",topics:["Science","Physics","Mechanics","Newton's Laws"],description:"Understand the concept of inertia and objects at rest.",views:"5.1M",likes:"180K"},{id:"v_periodic",title:"The Periodic Table: Atomic Radius",channel:"Crash Course",url:"https://www.youtube.com/watch?v=0RRVV4Diomg",thumbnail:"https://img.youtube.com/vi/0RRVV4Diomg/mqdefault.jpg",topics:["Science","Chemistry","Periodic Table"],description:"Navigate the most important chart in all of science.",views:"3.4M",likes:"125K"}],english:[{id:"v5",title:"8 Common Grammar Mistakes",channel:"Learn English with TV",url:"https://www.youtube.com/watch?v=Wp8u_fS-m7k",thumbnail:"https://img.youtube.com/vi/Wp8u_fS-m7k/mqdefault.jpg",topics:["English","Grammar","Writing","Punctuation"],description:"Avoid these common pitfalls to improve your writing instantly.",views:"9.2M",likes:"410K"},{id:"v_creative",title:"The Secret to Creative Writing",channel:"Ted-Ed",url:"https://www.youtube.com/watch?v=68K9IUnE-iI",thumbnail:"https://img.youtube.com/vi/68K9IUnE-iI/mqdefault.jpg",topics:["English","Writing","Storytelling"],description:"Learn how to build worlds and characters that feel alive.",views:"4.8M",likes:"250K"}]};function getRecommendations(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"math",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=String(e).toLowerCase(),i=s["physics"===a||"biology"===a?"science":a]||s.math;if(!t)return i.slice(0,2);let r=i.filter(e=>e.topics.some(e=>e.toLowerCase().includes(t.toLowerCase()))||e.title.toLowerCase().includes(t.toLowerCase()));return r.length>0?r:i.slice(0,2)}function getRecommendationReason(e,t){return e?"".concat(t," student").concat(t>1?"s are":" is"," currently struggling with ").concat(e,". These resources cover the core concepts."):"General enhancement for your current curriculum."}},2025:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return AssistantPage}});var s=a(5893);a(9008);var i=a(1664),r=a.n(i),n=a(5675),l=a.n(n),o=a(7294),d=a(1163);function Modal(e){let{open:t,title:a,children:i,onClose:r}=e;return((0,o.useEffect)(()=>{if(!t)return;let onKey=e=>{"Escape"===e.key&&(null==r||r())};return window.addEventListener("keydown",onKey),()=>window.removeEventListener("keydown",onKey)},[t,r]),t)?(0,s.jsxs)("div",{className:"fixed inset-0 z-50",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm",onMouseDown:r}),(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center p-4",children:(0,s.jsxs)("div",{className:"w-full max-w-md rounded-2xl border border-white/10 bg-white/80 dark:bg-slate-950/70 backdrop-blur-xl shadow-2xl",onMouseDown:e=>e.stopPropagation(),children:[(0,s.jsx)("div",{className:"px-5 pt-5",children:(0,s.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,s.jsx)("h3",{className:"text-lg font-extrabold text-slate-900 dark:text-slate-50",children:a}),(0,s.jsx)("button",{className:"rounded-lg px-2 py-1 text-slate-600 hover:text-slate-900 dark:text-slate-300 dark:hover:text-white",onClick:r,"aria-label":"Close",type:"button",children:"✕"})]})}),(0,s.jsx)("div",{className:"px-5 pb-5 pt-3",children:i})]})})]}):null}var c=a(3833);let u="elora_chat_threads_v1";function hasWindow(){return void 0!==window.localStorage}function now(){return Date.now()}function makeId(){return"c_".concat(now().toString(36),"_").concat(Math.random().toString(36).slice(2,10))}function normalizeMessage(e){let t=(null==e?void 0:e.from)==="elora"?"elora":"user",a=function(e){let t=String(e||"");return t.length<=8e3?t:t.slice(0,8e3)}((null==e?void 0:e.text)||""),s="number"==typeof(null==e?void 0:e.ts)?e.ts:now();return{from:t,text:a,ts:s}}function normalizeMessages(e){let t=Array.isArray(e)?e:[],a=t.map(normalizeMessage);return a.length>80?a.slice(a.length-80):a}function defaultStore(){return{v:1,users:{}}}function loadAll(){if(!hasWindow())return defaultStore();let e=window.localStorage.getItem(u),t=function(e){try{return JSON.parse(e)}catch(e){return null}}(e);return t&&"object"==typeof t&&t.users&&"object"==typeof t.users?{v:1,users:t.users}:defaultStore()}function saveAll(e){if(hasWindow())try{window.localStorage.setItem(u,JSON.stringify(e))}catch(e){}}function ensureUser(e,t){return e.users[t]||(e.users[t]={activeId:"",threads:[]}),Array.isArray(e.users[t].threads)||(e.users[t].threads=[]),"string"!=typeof e.users[t].activeId&&(e.users[t].activeId=""),e.users[t]}function pruneUser(e){!function(e){e.sort((e,t)=>{let a=(null==e?void 0:e.pinned)?1:0,s=(null==t?void 0:t.pinned)?1:0;return s!==a?s-a:((null==t?void 0:t.updatedAt)||0)-((null==e?void 0:e.updatedAt)||0)})}(e.threads),e.threads.length>20&&(e.threads=e.threads.slice(0,20));let t=new Set(e.threads.map(e=>e.id));if(!e.activeId||!t.has(e.activeId)){var a;e.activeId=(null===(a=e.threads[0])||void 0===a?void 0:a.id)||""}}function buildTitleFromMessages(e){let t=(e||[]).find(e=>(null==e?void 0:e.from)==="user"&&String((null==e?void 0:e.text)||"").trim()),a=String((null==t?void 0:t.text)||"").trim();if(!a)return"New chat";let s=a.replace(/\s+/g," ");return s.length>42&&(s=s.slice(0,42).trim()+"…"),s}function normalizeThread(e){let t=String((null==e?void 0:e.id)||"").trim()||makeId(),a=String((null==e?void 0:e.title)||"").trim()||"New chat",s="number"==typeof(null==e?void 0:e.createdAt)?e.createdAt:now(),i="number"==typeof(null==e?void 0:e.updatedAt)?e.updatedAt:s,r=!!(null==e?void 0:e.pinned),n=normalizeMessages((null==e?void 0:e.messages)||[]);return{id:t,title:a,createdAt:s,updatedAt:i,pinned:r,messages:n}}function getChatUserKey(e){let t=!!(null==e?void 0:e.verified),a=String((null==e?void 0:e.email)||"").trim().toLowerCase();return t&&a?"v:".concat(a):"guest"}function ensureThreadsForUser(e){let t=loadAll(),a=ensureUser(t,e);if(a.threads=(a.threads||[]).map(normalizeThread),!a.threads.length){let e=makeId();a.threads=[{id:e,title:"New chat",createdAt:now(),updatedAt:now(),pinned:!1,messages:[]}],a.activeId=e}return pruneUser(a),saveAll(t),{activeId:a.activeId,threads:a.threads}}function listThreads(e){let t=loadAll(),a=ensureUser(t,e);return a.threads=(a.threads||[]).map(normalizeThread),pruneUser(a),saveAll(t),a.threads.map(e=>({id:e.id,title:String(e.title||"New chat"),pinned:!!e.pinned,updatedAt:"number"==typeof e.updatedAt?e.updatedAt:0}))}function getActiveThreadId(e){let{activeId:t}=ensureThreadsForUser(e);return t}function getThreadMessages(e,t){let a=loadAll(),s=ensureUser(a,e);s.threads=(s.threads||[]).map(normalizeThread);let i=s.threads.find(e=>e.id===t)||s.threads.find(e=>e.id===s.activeId),r=normalizeMessages((null==i?void 0:i.messages)||[]);return i&&JSON.stringify(i.messages||[])!==JSON.stringify(r)&&(i.messages=r,i.updatedAt=now(),i.title&&"New chat"!==i.title||(i.title=buildTitleFromMessages(r)),pruneUser(s),saveAll(a)),r}var h=a(8400);let MotionComponent=e=>(0,o.forwardRef)((t,a)=>{let{children:i,className:r,animate:n,initial:l,exit:o,transition:d,whileHover:c,...u}=t;return(0,s.jsx)(e,{ref:a,className:r,...u,children:i})}),m={div:MotionComponent("div"),span:MotionComponent("span"),p:MotionComponent("p"),h1:MotionComponent("h1"),h2:MotionComponent("h2"),h3:MotionComponent("h3"),button:MotionComponent("button"),a:MotionComponent("a"),ul:MotionComponent("ul"),li:MotionComponent("li")},AnimatePresence=e=>{let{children:t,mode:a}=e;return(0,s.jsx)(s.Fragment,{children:t})};function cn(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return t.filter(Boolean).join(" ")}let p=["Singapore","United States","United Kingdom","Australia","Malaysia","Canada","New Zealand","India","Nigeria","Other"],x=["General","Math","Science","Physics","Chemistry","Biology","English","History","Geography","Computing","Literature","Economics"],g={educator:[{id:"explain",label:"Explain a concept",hint:"Classroom-ready explanation + one example"},{id:"lesson",label:"Plan a lesson",hint:"Objectives, timings, checks, differentiation"},{id:"assignment",label:"New Assignment",hint:"AI-generated student tasks ✨"},{id:"worksheet",label:"Create worksheet",hint:"Student + Teacher versions"},{id:"assessment",label:"Generate assessment",hint:"Marks + marking scheme"},{id:"slides",label:"Design slides",hint:"Deck outline + teacher notes"},{id:"resources",label:"Find Resources",hint:"Videos, PDFs, articles for class"}],student:[{id:"explain",label:"Explain it",hint:"Simple steps, beginner friendly"},{id:"quiz",label:"Generate Quiz",hint:"Test my knowledge right now ✨"},{id:"flashcards",label:"Make Flashcards",hint:"AI-powered study set ✨"},{id:"check",label:"Check my answer",hint:"Hints first. Answer unlocks on attempt 3."},{id:"study",label:"Study plan",hint:"Small steps, realistic plan"}],parent:[{id:"explain",label:"Explain to me",hint:"Plain language, no jargon"},{id:"tutor",label:"Tutor Mode",hint:"Help me coach my child ✨"},{id:"curriculum",label:"Topic Roadmap",hint:"See the journey ahead ✨"},{id:"message",label:"Write a message",hint:"To teacher or school"}]},f={explain:[{id:"simpler",label:"Make it simpler"},{id:"example",label:"Add an example"},{id:"steps",label:"Show steps"},{id:"check",label:"Add a quick check question"}],lesson:[{id:"diff",label:"Add differentiation"},{id:"timing",label:"Add timings"},{id:"check",label:"Add checks for understanding"},{id:"resources",label:"Add resources"}],worksheet:[{id:"easier",label:"Make it easier"},{id:"harder",label:"Make it harder"},{id:"answers",label:"Add teacher answers"},{id:"variants",label:"Add A/B versions"}],assessment:[{id:"markscheme",label:"Add mark scheme"},{id:"variants",label:"Add variants"},{id:"harder",label:"Make it harder"},{id:"easier",label:"Make it easier"}],slides:[{id:"outline",label:"Tighten outline"},{id:"hooks",label:"Add hook"},{id:"examples",label:"Add examples"},{id:"notes",label:"Add teacher notes"}],check:[{id:"more-steps",label:"Show more steps"},{id:"simpler",label:"Make it simpler"},{id:"example",label:"Add an example"}],study:[{id:"shorter",label:"Make it shorter"},{id:"steps",label:"Show steps"},{id:"check",label:"Add a check question"}],coach:[{id:"simpler",label:"Make it simpler"},{id:"steps",label:"Give steps"},{id:"check",label:"Add a check question"}],message:[{id:"shorter",label:"Make it shorter"},{id:"simpler",label:"Make it simpler"}],custom:[{id:"simpler",label:"Make it simpler"},{id:"example",label:"Add an example"},{id:"steps",label:"Show steps"}]},b={educator:e=>{let{country:t,level:a,subject:s,topic:i}=e,r=t||"your country",n=a||"your current level",l=s||"your subject",o=i||"a tricky topic your class is currently on";return["Draft a ".concat(n," ").concat(l," lesson on “").concat(o,"” using I Do / We Do / You Do, including key questions to ask and common misconceptions to watch for."),"Create a 10-minute Do Now + 25-minute main task + 5-minute exit ticket for ".concat(n," ").concat(l," on “").concat(o,"”, with printable prompts."),"Generate a quick formative check for “".concat(o,"”: 6 questions (2 easy, 2 medium, 2 stretch) with answers and what each question diagnoses."),"Write teacher feedback comments for 3 common student errors on “".concat(o,"” (one sentence each) plus a targeted next step for improvement."),"Build a rubric for ".concat(l," work on “").concat(o,"” (4 bands) with concrete descriptors and a sample “Band 3” exemplar answer."),"Differentiate “".concat(o,"” for 3 groups (support / core / challenge): provide 3 tasks per group and a short teacher script for transitions."),"Make a mini-quiz (8 questions) on “".concat(o,"” aligned to ").concat(n," ").concat(l," in ").concat(r,", with a mark scheme and reteach plan based on results."),"Turn “".concat(o,"” into a worked example set: 1 fully-worked example + 3 gradually harder practice questions + a self-check answer key.")]},parent:e=>{let{country:t,level:a,subject:s,topic:i}=e,r=t||"our country",n=a||"my child’s level",l=s||"schoolwork",o=i||"what they’re learning this week";return["Explain “".concat(o,"” in plain parent-friendly language, then give me a 2-minute “car ride explanation” I can say to my child at ").concat(n,"."),"Give me 3 at-home mini-activities to support ".concat(l," on “").concat(o,"” (10 minutes each, no printing, uses common household items)."),"Write 6 gentle conversation starters about “".concat(o,"” that feel supportive (not like a test) — good for dinner or bedtime chats."),"Create a simple checklist I can use to help with ".concat(l," homework on “").concat(o,"” without taking over (what to ask, what not to say)."),"Draft a calm “frustration reset” script for when homework gets tense, plus 3 options to step back while still keeping progress moving.","Make a 1-week routine for ".concat(n," (").concat(r,") to build confidence in ").concat(l,": 3 short sessions tied to “").concat(o,"” with specific steps."),"Give me 5 praise phrases that reward effort and strategy during “".concat(o,"” practice (and 3 follow-up questions that encourage thinking)."),"Turn “".concat(o,"” into a quick real-life example I can use at home, then give me 3 questions to check understanding in a low-pressure way.")]},student:e=>{let{level:t,subject:a,topic:s}=e,i=t||"my level",r=a||"my subject",n=s||"a topic I’m stuck on";return["Teach me “".concat(n,"” for ").concat(r," at ").concat(i," in 4 short steps, then ask me 2 quick check questions (wait for my answers)."),"Make me a 20-minute study sprint for “".concat(n,"”: warm-up → 2 focused drills → 1 mixed question → quick recap."),"Give me 6 practice questions on “".concat(n,"” at ").concat(i," and mark them one-by-one after I answer each (no spoilers)."),"I’ll paste my working for “".concat(n,"”. First highlight what I did correctly, then show the first wrong step and how to fix it."),"Help me revise “".concat(n,"” for an exam: 5-bullet summary, 3 “must know” rules, and 3 exam-style questions with a marking guide."),"Create a 7-day spaced revision plan for “".concat(n,"” with tiny daily tasks (5–10 minutes) and a self-test on day 7."),"Explain my mistake: I’ll paste a wrong answer about “".concat(n,"” — tell me the misconception and give 2 similar questions to practice."),"Make a “teach-back” script so I can explain “".concat(n,"” to a friend in 60 seconds, then quiz me with 3 short questions.")]}},v="elora_preview_notice_dismissed_v1",w="elora_assistant_prefs_open_v1";function cleanAssistantText(e){let t=String(e||"").replace(/<\s*internal\s*>[\s\S]*?<\s*\/\s*internal\s*>/gi,"").replace(/<\s*internal\s*\/\s*>/gi,"").replace(/<\s*internal\s*>/gi,"").trim();return(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/```[\s\S]*?```/g,"")).replace(/`+/g,"")).replace(/^\s{0,3}#{1,6}\s+/gm,"")).replace(/\*\*([^*]+)\*\*/g,"$1")).replace(/\*([^*]+)\*/g,"$1")).replace(/__([^_]+)__/g,"$1")).replace(/_([^_]+)_/g,"$1")).replace(/^\s*>\s?/gm,"")).replace(/\[([^\]]+)\]\(([^)]+)\)/g,"$1")).replace(/^\s*([-*_])\1\1+\s*$/gm,"")).replace(/<quiz_data>[\s\S]*?<\/quiz_data>/gi,"")).replace(/\n{3,}/g,"\n\n").trim()}function getCountryLevels(e){let t=String(e||"").toLowerCase();return t.includes("singapore")?["Primary School","Secondary School","Junior College / Pre-U","Polytechnic / ITE","University"]:t.includes("united states")||"us"===t||t.includes("usa")?["Elementary School","Middle School","High School","College / University"]:t.includes("united kingdom")||t.includes("uk")||t.includes("britain")||t.includes("england")?["Primary School","Secondary School","Sixth Form / College","University"]:t.includes("australia")?["Primary School","Secondary School","University / TAFE"]:t.includes("malaysia")?["Primary School (Standard 1-6)","Secondary School (Form 1-5)","Pre-University / STPM","University"]:["Primary School","Secondary School","Tertiary / Higher Ed","Adult Learning"]}async function compressImageToDataUrl(e){let{maxDim:t=1400,quality:a=.82}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=await new Promise((t,a)=>{let s=new FileReader;s.onerror=()=>a(Error("read_failed")),s.onload=()=>t(String(s.result||"")),s.readAsDataURL(e)}),i=await new Promise((e,t)=>{let a=new(l());a.onload=()=>e(a),a.onerror=()=>t(Error("image_decode_failed")),a.src=s}),r=i.width||1,n=i.height||1,o=Math.min(1,t/Math.max(r,n)),d=Math.max(1,Math.round(r*o)),c=Math.max(1,Math.round(n*o)),u=document.createElement("canvas");u.width=d,u.height=c;let h=u.getContext("2d",{alpha:!1});if(!h)throw Error("canvas_failed");h.drawImage(i,0,0,d,c);let m="image/jpeg",p=u.toDataURL(m,a);if(p.length>6e6){let t=u.toDataURL(m,.68);if(t.length>6e6)throw Error("image_too_large");return{dataUrl:t,mime:m,name:e.name||"image.jpg"}}return{dataUrl:p,mime:m,name:e.name||"image.jpg"}}let InteractiveQuiz=e=>{let{data:t,onComplete:a}=e,[i,r]=(0,o.useState)({}),[n,l]=(0,o.useState)(!1),[d,u]=(0,o.useState)(0);if(!(null==t?void 0:t.questions))return null;let h=t.questions.length,p=Object.keys(i).length,x=p/h*100;return(0,s.jsx)("div",{className:"mt-8 mb-4 space-y-6 animate-reveal",children:(0,s.jsxs)("div",{className:"p-8 rounded-[3rem] bg-indigo-500/5 dark:bg-indigo-500/10 border border-indigo-500/20 shadow-2xl overflow-hidden relative",children:[(0,s.jsx)("div",{className:"absolute top-0 left-0 h-1.5 bg-indigo-500/20 w-full",children:(0,s.jsx)("div",{className:"h-full bg-indigo-500 transition-all duration-500",style:{width:"".concat(x,"%")}})}),(0,s.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"text-xl font-black text-slate-900 dark:text-white leading-tight",children:t.title||"AI Knowledge Check"}),(0,s.jsxs)("p",{className:"text-[10px] font-black uppercase tracking-widest text-indigo-500 mt-1",children:["Question ",p," of ",h]})]}),(0,s.jsx)("div",{className:"w-12 h-12 bg-indigo-600 text-white rounded-2xl flex items-center justify-center text-xl shadow-lg shadow-indigo-500/20",children:"\uD83C\uDFAF"})]}),(0,s.jsx)("div",{className:"space-y-10",children:t.questions.map((e,t)=>{var a;return(0,s.jsxs)("div",{className:"space-y-4 group",children:[(0,s.jsxs)("div",{className:"flex gap-4",children:[(0,s.jsx)("span",{className:"w-8 h-8 rounded-full bg-indigo-500/10 text-indigo-500 flex items-center justify-center text-xs font-black shrink-0 border border-indigo-500/20",children:t+1}),(0,s.jsx)("p",{className:"text-[15px] font-bold text-slate-700 dark:text-slate-100 leading-relaxed pt-1",children:e.question})]}),(0,s.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 pl-12",children:null===(a=e.options)||void 0===a?void 0:a.map(t=>{let a=i[e.id]===t,l=n&&t===e.answer,o=n&&a&&t!==e.answer;return(0,s.jsx)("button",{disabled:n,onClick:()=>r({...i,[e.id]:t}),className:cn("group/opt p-4 rounded-2xl border-2 text-xs font-black transition-all text-left relative overflow-hidden",a?"border-indigo-500 bg-indigo-500 text-white shadow-xl scale-[1.02]":"border-slate-100 dark:border-white/5 bg-white dark:bg-slate-900 text-slate-600 dark:text-slate-400 hover:border-indigo-300 hover:bg-indigo-50/50",l&&"border-emerald-500 bg-emerald-500 text-white shadow-lg shadow-emerald-500/20",o&&"border-rose-500 bg-rose-500 text-white shadow-lg shadow-rose-500/20"),children:(0,s.jsxs)("div",{className:"relative z-10 flex items-center justify-between",children:[(0,s.jsx)("span",{children:t}),l&&(0,s.jsx)("span",{className:"text-xl",children:"✓"}),o&&(0,s.jsx)("span",{className:"text-xl",children:"✕"})]})},t)})})]},e.id)})}),n?(0,s.jsxs)(m.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"mt-10 p-8 rounded-[2.5rem] bg-white dark:bg-slate-950 border border-slate-100 dark:border-white/5 text-center shadow-xl",children:[(0,s.jsx)("div",{className:"text-5xl mb-4",children:d===h?"\uD83D\uDD25":d>h/2?"⭐️":"\uD83D\uDCAA"}),(0,s.jsxs)("div",{className:"flex items-center justify-center gap-2 mb-6",children:[(0,s.jsx)("div",{className:"w-2 h-2 rounded-full bg-emerald-500 animate-pulse"}),(0,s.jsx)("span",{className:"text-[10px] font-black uppercase tracking-widest text-emerald-500",children:"Live Synced to Teacher"})]}),(0,s.jsxs)("div",{className:"text-2xl font-black text-slate-900 dark:text-white uppercase tracking-tighter",children:["Session Result: ",d," / ",h]}),(0,s.jsx)("div",{className:"mt-2 h-2 bg-slate-100 dark:bg-white/5 rounded-full max-w-[200px] mx-auto overflow-hidden",children:(0,s.jsx)("div",{className:"h-full bg-indigo-500",style:{width:"".concat(d/h*100,"%")}})}),(0,s.jsxs)("p",{className:"text-xs font-medium text-slate-500 mt-6 max-w-sm mx-auto leading-relaxed",children:["Analysis: ",d===h?"Perfect mastery! You've unlocked a momentum boost.":"Solid effort. Elora has prepared specific review videos in the Resource Lab to help you bridge the gap."]})]}):(0,s.jsx)("button",{onClick:()=>{var e;let s=0,r=t.questions.map(e=>({question:e.question,studentAnswer:i[e.id],correctAnswer:e.answer,isCorrect:i[e.id]===e.answer}));t.questions.forEach(e=>{i[e.id]===e.answer&&s++}),u(s),l(!0);let n=(0,c.Gg)(),o={id:"sub_".concat(Date.now()),studentName:(null===(e=n.email)||void 0===e?void 0:e.split("@")[0])||"Guest Student",quizTitle:t.title||"Quick Knowledge Check",score:s,total:h,details:r,timestamp:new Date().toISOString()};n.classroom||(n.classroom={}),n.classroom.submissions||(n.classroom.submissions=[]),n.classroom.submissions=[o,...n.classroom.submissions],(0,c.Aj)(n),a&&a(s,h)},disabled:p<h,className:"mt-10 w-full py-5 bg-indigo-600 text-white rounded-3xl font-black text-sm uppercase tracking-widest shadow-2xl shadow-indigo-500/30 disabled:opacity-30 disabled:cursor-not-allowed hover:scale-[1.02] active:scale-95 transition-all",children:"Grade My Progress →"})]})})},AIResourceDrawer=e=>{let{open:t,onClose:a,topic:i,subject:r}=e,[n,d]=(0,o.useState)([]);return(0,o.useEffect)(()=>{t&&d((0,h.$K)(r,i))},[t,i,r]),(0,s.jsx)(AnimatePresence,{children:t&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(m.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:a,className:"fixed inset-0 bg-slate-950/40 backdrop-blur-[2px] z-[100]"}),(0,s.jsxs)(m.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{type:"spring",damping:25,stiffness:200},className:"fixed top-0 right-0 h-full w-full max-w-md bg-white dark:bg-slate-950 shadow-[-20px_0_50px_rgba(0,0,0,0.2)] z-[101] flex flex-col border-l border-slate-100 dark:border-white/5",children:[(0,s.jsxs)("div",{className:"p-8 border-b border-slate-100 dark:border-white/5 flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-xl font-black text-slate-900 dark:text-white",children:"Resource Lab"}),(0,s.jsxs)("p",{className:"text-[10px] font-black uppercase tracking-widest text-indigo-500 mt-1",children:['AI Curated for "',i||r,'"']})]}),(0,s.jsx)("button",{onClick:a,className:"p-3 hover:bg-slate-50 dark:hover:bg-white/5 rounded-2xl transition-all font-black text-slate-400",children:"✕"})]}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto p-8 space-y-6 custom-scrollbar",children:0===n.length?(0,s.jsxs)("div",{className:"text-center py-20 space-y-4",children:[(0,s.jsx)("div",{className:"text-4xl",children:"\uD83D\uDD0E"}),(0,s.jsx)("p",{className:"text-sm font-bold text-slate-400",children:"Expanding the library... check back in a few seconds."})]}):n.map((e,t)=>(0,s.jsxs)(m.a,{href:e.url,target:"_blank",rel:"noopener noreferrer",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*t},className:"block group p-4 rounded-3xl bg-slate-50 dark:bg-white/5 border border-transparent hover:border-indigo-500/50 hover:bg-white dark:hover:bg-slate-900 transition-all shadow-sm hover:shadow-xl",children:[(0,s.jsxs)("div",{className:"aspect-video rounded-2xl overflow-hidden mb-4 relative",children:[(0,s.jsx)(l(),{src:e.thumbnail||"https://images.unsplash.com/photo-1546410531-bb4caa1b4247?auto=format&fit=crop&q=80&w=400",alt:e.title,fill:!0,className:"object-cover group-hover:scale-105 transition-transform duration-500"}),(0,s.jsx)("div",{className:"absolute inset-0 bg-indigo-600/10 group-hover:bg-transparent transition-colors"}),(0,s.jsx)("div",{className:"absolute bottom-2 right-2 px-2 py-1 bg-slate-900/80 backdrop-blur-md text-[8px] font-black text-white rounded-lg",children:"LIVE"})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("div",{className:"text-[10px] font-black uppercase tracking-widest text-indigo-500",children:e.type||"VIDEO"}),(0,s.jsx)("h4",{className:"text-sm font-black text-slate-900 dark:text-white group-hover:text-indigo-600 transition-colors leading-snug",children:e.title}),(0,s.jsx)("p",{className:"text-[10px] font-medium text-slate-500 line-clamp-2 mt-2 leading-relaxed",children:e.description})]})]},t))}),(0,s.jsxs)("div",{className:"p-8 bg-indigo-600 text-white",children:[(0,s.jsx)("p",{className:"text-[10px] font-black uppercase tracking-widest opacity-60 mb-2",children:"Mastery Tip"}),(0,s.jsx)("p",{className:"text-xs font-bold leading-relaxed",children:"Watching visual breakdowns often improves retention by 40%. Try summarizing these in your own words."})]})]})]})})};function AssistantPage(){var e,t,a;(0,d.useRouter)();let[i,n]=(0,o.useState)(()=>(0,c.Gg)()),[l,u]=(0,o.useState)(()=>(null==i?void 0:i.role)||"student"),[h,y]=(0,o.useState)(()=>(null==i?void 0:i.country)||"Singapore"),[k,j]=(0,o.useState)(()=>(null==i?void 0:i.level)||"Primary School"),[N,S]=(0,o.useState)(()=>(null==i?void 0:i.subject)||"General"),[A,C]=(0,o.useState)(()=>(null==i?void 0:i.topic)||""),[E,D]=(0,o.useState)(()=>(null==i?void 0:i.action)||"explain"),[T,M]=(0,o.useState)("None"),[I,L]=(0,o.useState)("Focused"),[q,_]=(0,o.useState)("Normal"),[U,P]=(0,o.useState)(!1),[z,R]=(0,o.useState)(""),[G,K]=(0,o.useState)(()=>getChatUserKey((0,c.Gg)())),[O,F]=(0,o.useState)([]),[W,B]=(0,o.useState)(""),[H,X]=(0,o.useState)([]),[V,J]=(0,o.useState)(""),[Q,$]=(0,o.useState)(!1),[Y,Z]=(0,o.useState)(0),[ee,et]=(0,o.useState)(!1),[ea,es]=(0,o.useState)(!0),[ei,er]=(0,o.useState)(!1),[en,el]=(0,o.useState)(-1),[eo,ed]=(0,o.useState)(!0),[ec,eu]=(0,o.useState)(!1),[eh,em]=(0,o.useState)(!1),[ep,ex]=(0,o.useState)(Date.now()),[eg,ef]=(0,o.useState)(""),[eb,ev]=(0,o.useState)(""),[ew,ey]=(0,o.useState)(!1),[ek,ej]=(0,o.useState)(!1),[eN,eS]=(0,o.useState)(""),[eA,eC]=(0,o.useState)(!1),[eE,eD]=(0,o.useState)(null),[eT,eM]=(0,o.useState)(""),eI=(0,o.useRef)(null),eL=!!(null==i?void 0:i.verified),eq=(null==i?void 0:null===(e=i.classroom)||void 0===e?void 0:e.code)||"",e_=!(null==i?void 0:i.verified)&&"educator"===l,eU="educator"===l?"Assistant":"Elora";function jumpToLatest(){let e=eI.current;e&&(e.scrollTop=e.scrollHeight,ed(!0),eu(!1))}async function copyToClipboard(e,t){let a=String(e||"").trim();if(a)try{var s,i;if(null===(i=navigator)||void 0===i?void 0:null===(s=i.clipboard)||void 0===s?void 0:s.writeText)await navigator.clipboard.writeText(a);else{let e=document.createElement("textarea");e.value=a,e.setAttribute("readonly","true"),e.style.position="fixed",e.style.top="-9999px",document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)}el(t),window.setTimeout(()=>el(-1),900)}catch(e){}}async function persistSessionPatch(e){}async function saveServerChatIfVerified(e,t){try{if(!(null==e?void 0:e.verified))return;await fetch("/api/chat/set",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:t})})}catch(e){}}function syncThreadsState(e){let t=ensureThreadsForUser(e),a=(null==t?void 0:t.activeId)||getActiveThreadId(e);F(listThreads(e)),B(a);let s=getThreadMessages(e,a)||[];return X(s),a}function setActiveThreadAndLoad(e){let t=function(e,t){let a=loadAll(),s=ensureUser(a,e);s.threads=(s.threads||[]).map(normalizeThread);let i=s.threads.some(e=>e.id===t);return i?(s.activeId=t,pruneUser(s),saveAll(a),s.activeId):getActiveThreadId(e)}(G,e);B(t),F(listThreads(G));let a=getThreadMessages(G,t);X(a),Z(0),eD(null),eM(""),er(!1)}function persistActiveMessages(e){let{alsoSyncServer:t=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(X(e),!eL)return;!function(e,t,a){let s=loadAll(),i=ensureUser(s,e);i.threads=(i.threads||[]).map(normalizeThread);let r=i.threads.find(e=>e.id===t);if(!r){let e=String(t||"").trim()||makeId();r={id:e,title:"New chat",createdAt:now(),updatedAt:now(),pinned:!1,messages:[]},i.threads.unshift(r),i.activeId=e}let n=normalizeMessages(a);r.messages=n,r.updatedAt=now(),r.title&&"New chat"!==r.title||(r.title=buildTitleFromMessages(n)),i.activeId=r.id,pruneUser(i),saveAll(s),i.activeId}(G,W,e),F(listThreads(G));let a=e.length>H.length;if(a){let e=(0,c.Gg)();e.usage||(e.usage={messagesSent:0,subjects:[],streak:0}),e.usage.messagesSent=(Number(e.usage.messagesSent)||0)+1,N&&!Array.isArray(e.usage.subjects)&&(e.usage.subjects=[]),N&&!e.usage.subjects.includes(N)&&e.usage.subjects.push(N),Array.isArray(e.usage.sessionLog)||(e.usage.sessionLog=[]);let t={ts:new Date().toISOString(),subject:N||"General",action:E};e.usage.sessionLog=[t,...e.usage.sessionLog].slice(0,50),e.usage.lastActive=new Date().toISOString(),e.usage.streak=Math.max(Number(e.usage.streak)||0,1),(0,c.Aj)(e)}if(t){let t=(0,c.Gg)();saveServerChatIfVerified(t,e)}}async function callElora(e){let{messageOverride:t,baseMessages:a}=e,s=(0,c.Gg)(),i=String(t||V||"").trim();if(i||(null==eE?void 0:eE.dataUrl)){$(!0);try{var r;if("educator"===l&&!(null==s?void 0:s.verified)){ey(!0),$(!1);return}if(e_){ej(!0),$(!1);return}let e="student"===l&&"check"===E?Math.min(3,Y+1):0,t=(Date.now()-ep)/1e3,n={role:l,action:E,country:h,level:k,subject:N,topic:A,constraints:T,contextMode:I,responseStyle:q,searchMode:U,customStyleText:z,attempt:e,sentiment:e>1||t>60?"supportive":"standard",vision:!0,classCode:eq,message:i,messages:Array.isArray(a)?a:H,teacherRules:(null===(r=s.classroom)||void 0===r?void 0:r.teacherRules)||""},o=await fetch("/api/assistant",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),d=await o.json().catch(()=>null),c=Array.isArray(a)?a:H;if(!o.ok){let e=(null==d?void 0:d.error)||(null==d?void 0:d.message)||"Request failed.";String(e).toLowerCase().includes("verify")&&ey(!0);let t=[...c,{from:"elora",text:"Error: ".concat(String(e)),ts:Date.now()}];persistActiveMessages(t,{alsoSyncServer:!0}),$(!1);return}let u=(null==d?void 0:d.reply)||(null==d?void 0:d.text)||(null==d?void 0:d.answer)||"";if(!u){let e=[...c,{from:"elora",text:"I'm sorry, I couldn't generate a response. Please try rephrasing.",ts:Date.now()}];persistActiveMessages(e,{alsoSyncServer:!0}),$(!1);return}let m=cleanAssistantText(u),p=[...c,{from:"elora",text:m,ts:Date.now()}];persistActiveMessages(p,{alsoSyncServer:!0}),"student"===l&&"check"===E&&Z(e=>e+1),eD(null),eM("")}catch(t){console.error("AI Assistant Error:",t);let e=[...H,{from:"elora",text:"⚠️ System Error: ".concat(t.message||"Connection failed",". This usually happens if the backend server is busy. Please try again in 5 seconds."),ts:Date.now()}];persistActiveMessages(e,{alsoSyncServer:!0})}finally{J(""),$(!1),ex(Date.now())}}}async function sendChat(){let e=String(V||"").trim();if(!e&&!(null==eE?void 0:eE.dataUrl)||Q)return;$(!0),eM("");let t=function(e){let t=String(e||"").toLowerCase();return t.trim()?t.includes("check my answer")||t.includes("is this correct")||t.includes("is it correct")||t.includes("am i correct")||t.includes("did i get it right")||t.includes("right or wrong")||t.includes("correct or not")||/\bmy answer\b/.test(t)||/\banswer\s*:\s*/.test(t)||/\b=\s*-?\d/.test(t)?"check":t.includes("lesson plan")?"lesson":t.includes("worksheet")?"worksheet":t.includes("assessment")||t.includes("test")||t.includes("quiz")?"assessment":t.includes("slides")||t.includes("powerpoint")?"slides":null:null}(e);"check"===t&&"check"!==E&&(D("check"),Z(0),await persistSessionPatch({action:"check"}));let a={from:"user",text:e||"(image)",ts:Date.now()};X(t=>{let s=[...t,a];return persistActiveMessages(s,{alsoSyncServer:!0}),setTimeout(()=>{callElora({messageOverride:e,baseMessages:s})},0),s})}async function exportLast(e){let t=[...H].reverse().find(e=>(null==e?void 0:e.from)==="elora");if(!(null==t?void 0:t.text)){let e=[...H,{from:"elora",text:"Nothing to export yet — ask me something first.",ts:Date.now()}];persistActiveMessages(e,{alsoSyncServer:!1});return}if(!eL){ey(!0);let e=[...H,{from:"elora",text:"Exports are locked until your email is verified.",ts:Date.now()}];persistActiveMessages(e,{alsoSyncServer:!1});return}try{let a=cleanAssistantText(t.text),s=await fetch("docx"===e?"/api/export-docx":"pptx"===e?"/api/export-slides":"/api/export-pdf",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:"pptx"===e?"Elora Slides":"docx"===e?"Elora Notes":"Elora Export",content:a})}),i=String(s.headers.get("content-type")||"");if(!s.ok||i.includes("application/json")){let e="Export failed (HTTP ".concat(s.status,")."),t=null;try{t=await s.json()}catch(e){}let a=String((null==t?void 0:t.error)||(null==t?void 0:t.message)||"").trim();403===s.status||"not_verified"===a?(ey(!0),e="Export blocked: verify your email to unlock exports."):a&&(e="Export failed: ".concat(a));let i=[...H,{from:"elora",text:e,ts:Date.now()}];persistActiveMessages(i,{alsoSyncServer:!1});return}let r=await s.blob();if(!r||0===r.size){let e=[...H,{from:"elora",text:"Export failed: empty file returned.",ts:Date.now()}];persistActiveMessages(e,{alsoSyncServer:!1});return}let n=URL.createObjectURL(r),l=document.createElement("a");l.href=n,l.download="pptx"===e?"elora.pptx":"docx"===e?"elora.docx":"elora.pdf",document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(n)}catch(t){let e=[...H,{from:"elora",text:"Export failed due to a network error. Try again.",ts:Date.now()}];persistActiveMessages(e,{alsoSyncServer:!1})}}async function applyRefinement(e){let t={simpler:"Make it simpler and more beginner-friendly.",example:"Add one clear example that matches the topic.",steps:"Show the steps clearly (short).",check:"Give one quick check question at the end.",diff:"Add differentiation: easier + harder extension.",timing:"Add a simple timeline with approximate minutes.",resources:"Add a short list of materials/resources.",easier:"Make it easier while keeping the same topic.",harder:"Make it harder and add a challenge question.",answers:"Add a teacher answer key after the questions.",rubric:"Add a short marking guide/rubric.",shorter:"Make it shorter and more direct.",markscheme:"Include a clear marking scheme.",variants:"Add two variants (A/B) with the same skills tested.",outline:"Tighten the slide outline into clear sections.",hooks:"Add 1-2 engaging hooks or questions for the start.",examples:"Add more examples that students can relate to.",notes:"Add short teacher notes for each section.","more-steps":"Add more steps and explain the reasoning clearly."}[e]||"Improve the answer.",a={from:"user",text:t,ts:Date.now()},s=[...H,a];persistActiveMessages(s,{alsoSyncServer:!0}),await callElora({messageOverride:t,baseMessages:s})}async function validateAndActivateInvite(e){let t=(e||"").trim();if(eS(""),!t)return eS("Enter a code."),!1;if(!eL)return eS("Verify your email first."),!1;try{let e=await (0,c.e6)(t);if(!(null==e?void 0:e.ok))return eS("Invalid code."),!1;await (0,c.S0)();let a=(0,c.Gg)();if(n(a),(0,c.IR)())return eS("Teacher role active ✅"),!0;return eS("Code accepted, but teacher role not active. Refresh and try again."),!1}catch(e){return eS("Could not validate right now. Try again."),!1}}async function onPickImage(e){if(eM(""),eD(null),e){if(!e.type||!e.type.startsWith("image/")){eM("Images only (PNG/JPG/WebP).");return}if(e.size>5242880){eM("That image is too large. Try a smaller photo (max 5MB).");return}try{let t=await compressImageToDataUrl(e);eD(t)}catch(t){let e=String((null==t?void 0:t.message)||"");eM("image_too_large"===e?"That image is too large to send. Try a closer crop.":"Couldn’t attach that image. Try again.")}}}function onRenameConfirm(){eb.trim()&&(!function(e,t,a){let s=String(a||"").replace(/\s+/g," ").trim(),i=s?s.slice(0,60):"New chat",r=loadAll(),n=ensureUser(r,e);n.threads=(n.threads||[]).map(normalizeThread);let l=n.threads.find(e=>e.id===t);l&&(l.title=i,l.updatedAt=now(),pruneUser(n),saveAll(r))}(G,eg,eb.trim()),F(listThreads(G)),ef(""))}return(0,o.useEffect)(()=>{et(!0);{let e="false"!==window.localStorage.getItem(w);es(e)}},[]),(0,o.useEffect)(()=>{try{let e="true"===window.localStorage.getItem(v);em(e)}catch(e){em(!1)}},[]),(0,o.useEffect)(()=>{if(eL){try{window.localStorage.removeItem(v)}catch(e){}em(!1)}},[eL]),(0,o.useEffect)(()=>{let e=getCountryLevels(h);e.includes(k)||j(e[0]||"Primary 1")},[h]),(0,o.useEffect)(()=>{function onSessionEvent(){let e=(0,c.Gg)();n(e),u((null==e?void 0:e.role)||"student"),y((null==e?void 0:e.country)||"Singapore");let t=getCountryLevels((null==e?void 0:e.country)||"Singapore"),a=t.includes(null==e?void 0:e.level)?e.level:t[0]||"Primary 1";j(a),S((null==e?void 0:e.subject)||"General"),C((null==e?void 0:e.topic)||""),D((null==e?void 0:e.action)||"explain")}return window.addEventListener("elora:session",onSessionEvent),()=>{window.removeEventListener("elora:session",onSessionEvent)}},[]),(0,o.useEffect)(()=>{"student"===l&&"check"===E||Z(0)},[l,E]),(0,o.useEffect)(()=>{let e=eI.current;e&&eo&&(e.scrollTop=e.scrollHeight)},[H,Q,eo]),(0,o.useEffect)(()=>{let e=!0;return(async()=>{if(await (0,c.S0)(),!e)return;let t=(0,c.Gg)();n(t),u((null==t?void 0:t.role)||"student");let a=getCountryLevels((null==t?void 0:t.country)||"Singapore");j(a.includes(null==t?void 0:t.level)?t.level:a[0]||"Primary 1");let s=getChatUserKey(t);K(s),syncThreadsState(s)})(),()=>{e=!1}},[]),(0,o.useEffect)(()=>{let e=(0,c.Gg)(),t=getChatUserKey(e);t!==G&&(K(t),syncThreadsState(t),Z(0),eD(null),eM(""),er(!1))},[eL,null==i?void 0:i.email]),(0,o.useEffect)(()=>{},[l,h,k,N,A,E]),(0,o.useEffect)(()=>{let e=setInterval(()=>{let e=(0,c.Gg)();e.usage||(e.usage={activeMinutes:0}),e.usage.activeMinutes=(Number(e.usage.activeMinutes)||0)+1,e.usage.lastActive=new Date().toISOString(),(0,c.Aj)(e)},6e4);return()=>clearInterval(e)},[]),((0,o.useEffect)(()=>{let handleScroll=()=>{let e=eI.current;if(!e)return;let t=e.scrollHeight-e.scrollTop<=e.clientHeight+1;ed(t),eu(!t)},e=eI.current;return e&&(e.addEventListener("scroll",handleScroll),handleScroll()),()=>{e&&e.removeEventListener("scroll",handleScroll)}},[H,Q]),(0,o.useEffect)(()=>{eo&&jumpToLatest()},[H,eo]),(0,o.useEffect)(()=>{let handleKeyDown=e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),sendChat())};return window.addEventListener("keydown",handleKeyDown),()=>{window.removeEventListener("keydown",handleKeyDown)}},[V,Q,eE,H,E,l,ep]),(0,o.useEffect)(()=>{let e=(0,c.Gg)(),t=getChatUserKey(e);t!==G&&(K(t),syncThreadsState(t),Z(0),eD(null),eM(""),er(!1))},[null==i?void 0:i.email,null==i?void 0:i.verified]),(0,o.useEffect)(()=>{let e=(0,c.Gg)(),t={...e,role:l,country:h,level:k,subject:N,topic:A,action:E};(0,c.Aj)(t)},[l,h,k,N,A,E]),(0,o.useEffect)(()=>{J("")},[W]),(0,o.useEffect)(()=>{eC(!1)},[A,N]),(0,o.useEffect)(()=>{"student"===l&&"check"===E||Z(0)},[l,E]),(0,o.useEffect)(()=>{if(eT){let e=setTimeout(()=>eM(""),5e3);return()=>clearTimeout(e)}},[eT]),(0,o.useEffect)(()=>{if(eN){let e=setTimeout(()=>eS(""),5e3);return()=>clearTimeout(e)}},[eN]),(0,o.useEffect)(()=>{if(eg&&eb){let e=document.getElementById("rename-input");e&&e.focus()}},[eg,eb]),(0,o.useEffect)(()=>{},[ew]),(0,o.useEffect)(()=>{},[ek]),(0,o.useEffect)(()=>{},[ei]),(0,o.useEffect)(()=>{try{window.localStorage.setItem(v,eh?"true":"false")}catch(e){}},[eh]),(0,o.useEffect)(()=>()=>{$(!1)},[]),ee)?(0,s.jsxs)("div",{className:"flex flex-col h-screen bg-white dark:bg-slate-950 text-slate-900 dark:text-white selection:bg-indigo-500/30 overflow-hidden font-sans",children:[(0,s.jsxs)("div",{className:"flex flex-1 overflow-hidden relative",children:[(0,s.jsx)(AnimatePresence,{children:ea&&(0,s.jsxs)(m.div,{initial:{x:-100,opacity:0},animate:{x:0,opacity:1},exit:{x:-100,opacity:0},className:"w-full lg:w-80 h-full bg-slate-50 dark:bg-slate-900 border-r border-slate-100 dark:border-white/5 z-[40] fixed lg:relative flex flex-col",children:[(0,s.jsxs)("div",{className:"p-8 border-b border-slate-100 dark:border-white/5",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-8 group/header",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-10 h-10 bg-indigo-600 rounded-2xl flex items-center justify-center text-xl shadow-xl shadow-indigo-500/20 group-hover/header:rotate-12 transition-transform duration-500",children:"\uD83D\uDEF8"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-xl font-black italic tracking-tighter",children:"ELORA"}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)("div",{className:"w-1 h-1 rounded-full bg-indigo-500 animate-pulse"}),(0,s.jsx)("span",{className:"text-[7px] font-black uppercase tracking-widest text-indigo-500/60",children:"Advanced Neural Link"})]})]})]}),(0,s.jsx)("button",{onClick:()=>{es(!1);try{window.localStorage.setItem(w,"false")}catch(e){}},className:"lg:hidden p-2 text-slate-400 hover:text-slate-900 dark:hover:text-white transition-all",children:"✕"})]}),(0,s.jsx)("div",{className:"space-y-6",children:(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400 ml-2",children:"Personalization"}),(0,s.jsxs)("div",{className:"space-y-4 p-4 rounded-3xl bg-white dark:bg-slate-800/50 border border-slate-100 dark:border-white/5 shadow-sm",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("span",{className:"text-[9px] font-black uppercase tracking-widest text-indigo-500 ml-1",children:"Syllabus Environment"}),(0,s.jsx)("select",{value:h,onChange:e=>y(e.target.value),className:"w-full bg-slate-50 dark:bg-slate-900 border-none rounded-xl px-3 py-2.5 text-[11px] font-bold focus:ring-2 ring-indigo-500/20 outline-none",children:p.map(e=>(0,s.jsx)("option",{value:e,children:e},e))})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("span",{className:"text-[9px] font-black uppercase tracking-widest text-indigo-500 ml-1",children:"Academic Grade"}),(0,s.jsx)("select",{value:k,onChange:e=>j(e.target.value),className:"w-full bg-slate-50 dark:bg-slate-900 border-none rounded-xl px-3 py-2.5 text-[11px] font-bold focus:ring-2 ring-indigo-500/20 outline-none",children:getCountryLevels(h).map(e=>(0,s.jsx)("option",{value:e,children:e},e))})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("span",{className:"text-[9px] font-black uppercase tracking-widest text-indigo-500 ml-1",children:"Target Subject"}),(0,s.jsx)("select",{value:N,onChange:e=>S(e.target.value),className:"w-full bg-slate-50 dark:bg-slate-900 border-none rounded-xl px-3 py-2.5 text-[11px] font-bold focus:ring-2 ring-indigo-500/20 outline-none",children:x.map(e=>(0,s.jsx)("option",{value:e,children:e},e))})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("span",{className:"text-[9px] font-black uppercase tracking-widest text-indigo-500 ml-1",children:"Current Topic"}),(0,s.jsx)("input",{type:"text",placeholder:"e.g. Algebra I",value:A,onChange:e=>C(e.target.value),className:"w-full bg-slate-50 dark:bg-slate-900 border-none rounded-xl px-3 py-2.5 text-[11px] font-bold focus:ring-2 ring-indigo-500/20 outline-none placeholder:text-slate-400"})]})]})]})})]}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 custom-scrollbar",children:[(0,s.jsx)("div",{className:"grid grid-cols-2 gap-2",children:Object.keys(g).map(e=>(0,s.jsx)("button",{onClick:()=>u(e),className:cn("p-3 rounded-2xl border text-[10px] font-black uppercase tracking-widest transition-all",l===e?"bg-indigo-600 border-indigo-400 text-white shadow-xl shadow-indigo-500/20":"bg-white dark:bg-slate-800/50 border-slate-100 dark:border-white/5 text-slate-400 hover:border-indigo-500/30"),children:e},e))}),(0,s.jsxs)("div",{className:"p-6 rounded-[2rem] bg-gradient-to-br from-indigo-500/10 to-purple-500/10 border border-indigo-500/20 space-y-4 backdrop-blur-sm relative overflow-hidden group",children:[(0,s.jsx)("div",{className:"absolute -right-4 -top-4 w-16 h-16 bg-white/10 blur-2xl group-hover:bg-white/20 transition-all"}),(0,s.jsxs)("div",{className:"flex items-center justify-between relative z-10",children:[(0,s.jsx)("span",{className:"text-[10px] font-black uppercase tracking-widest text-indigo-500",children:"Learning Mastery"}),(0,s.jsx)("span",{className:"text-[10px] font-black text-indigo-600 bg-white dark:bg-slate-900 px-2 py-0.5 rounded-full border border-indigo-100 dark:border-white/5",children:"Tier 8"})]}),(0,s.jsx)("div",{className:"h-2 bg-slate-200 dark:bg-white/10 rounded-full overflow-hidden relative z-10",children:(0,s.jsx)(m.div,{initial:{width:0},animate:{width:"68%"},transition:{duration:1.5,ease:"easeOut"},className:"h-full bg-gradient-to-r from-indigo-500 to-purple-600 shadow-[0_0_10px_rgba(79,70,229,0.5)]"})}),(0,s.jsxs)("div",{className:"flex justify-between items-center text-[9px] font-bold text-slate-400 uppercase tracking-widest relative z-10",children:[(0,s.jsx)("span",{children:"1,240 XP"}),(0,s.jsx)("span",{children:"2,000 XP"})]})]})]})]})}),(0,s.jsxs)("div",{className:"flex-1 flex flex-col min-w-0 bg-white dark:bg-slate-950 relative",children:[(0,s.jsxs)("div",{className:"h-20 flex items-center justify-between px-6 lg:px-8 border-b border-slate-100 dark:border-white/5 bg-white/80 dark:bg-slate-950/80 backdrop-blur-xl z-20 shrink-0",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)("button",{onClick:()=>{let e=!ea;es(e);try{window.localStorage.setItem(w,String(e))}catch(e){}},className:"lg:hidden p-3 hover:bg-slate-100 dark:hover:bg-white/5 rounded-2xl transition-all",children:[(0,s.jsx)("div",{className:"w-5 h-0.5 bg-slate-900 dark:bg-white mb-1"}),(0,s.jsx)("div",{className:"w-5 h-0.5 bg-slate-900 dark:bg-white mb-1"}),(0,s.jsx)("div",{className:"w-3 h-0.5 bg-slate-900 dark:bg-white"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"lg:hidden w-8 h-8 bg-indigo-600 rounded-xl flex items-center justify-center text-sm shadow-xl",children:"\uD83D\uDEF8"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-sm font-black tracking-tight",children:W?(null===(t=O.find(e=>e.id===W))||void 0===t?void 0:t.name)||"Current Session":"New Link"}),(0,s.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,s.jsx)("div",{className:"w-1 h-1 rounded-full bg-emerald-500 animate-pulse"}),(0,s.jsx)("span",{className:"text-[9px] font-black uppercase tracking-widest text-slate-400",children:Q?"Neural Analysis...":"Adapting to ".concat(k," ").concat(N)})]})]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("button",{onClick:()=>eC(!0),className:"hidden sm:flex items-center gap-2 px-4 py-2 bg-indigo-500/10 text-indigo-500 hover:bg-indigo-500/20 rounded-2xl transition-all font-black text-[10px] uppercase tracking-widest",children:[(0,s.jsx)("span",{children:"Resource Lab"}),(0,s.jsx)("span",{className:"w-4 h-4 rounded-full bg-indigo-500 text-white flex items-center justify-center text-[8px]",children:"✨"})]}),(0,s.jsx)("div",{className:"h-6 w-px bg-slate-100 dark:border-white/5 mx-2 hidden sm:block"}),(0,s.jsx)("button",{onClick:()=>er(!ei),className:"p-3 hover:bg-slate-100 dark:hover:bg-white/5 rounded-2xl transition-all text-slate-400",children:"\uD83D\uDD52"})]})]}),(0,s.jsx)("div",{ref:eI,className:"flex-1 overflow-y-auto overflow-x-hidden p-6 lg:p-10 space-y-10 custom-scrollbar scroll-smooth",children:0===H.length?(0,s.jsx)("div",{className:"max-w-3xl mx-auto pt-10 sm:pt-20",children:(0,s.jsxs)(m.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"text-center space-y-8",children:[(0,s.jsxs)("div",{className:"relative inline-block",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-indigo-500 blur-3xl opacity-20 animate-pulse"}),(0,s.jsx)("div",{className:"relative w-24 h-24 bg-indigo-600 rounded-[2.5rem] flex items-center justify-center text-4xl shadow-2xl shadow-indigo-500/40 mx-auto",children:"\uD83D\uDEF8"})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("h1",{className:"text-4xl font-black tracking-tight text-slate-900 dark:text-white leading-tight",children:["Ready to learn, ",(0,s.jsx)("span",{className:"text-indigo-600",children:(null==i?void 0:null===(a=i.email)||void 0===a?void 0:a.split("@")[0])||"Explorer"}),"?"]}),(0,s.jsxs)("p",{className:"text-sm font-medium text-slate-500 dark:text-slate-400 max-w-sm mx-auto leading-relaxed",children:["I'm Elora, your cinematic AI tutor. Your subject is set to ",(0,s.jsx)("span",{className:"text-indigo-500 font-bold",children:N}),"."]})]}),(0,s.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 pt-8",children:(function(e){let t,{seed:a,role:s,country:i,level:r,subject:n,topic:l}=e,o=b["educator"===s||"teacher"===s?"educator":"parent"===s?"parent":"student"]||b.student,d=o({country:i,level:r,subject:n,topic:l})||[];if(!d.length)return[];let c=(t=function(e){let t=String(e||""),a=2166136261;for(let e=0;e<t.length;e++)a^=t.charCodeAt(e),a=Math.imul(a,16777619);return a>>>0}(a)>>>0,()=>{let e=t+=1831565813;return e=Math.imul(e^e>>>15,1|e),(((e^=e+Math.imul(e^e>>>7,61|e))^e>>>14)>>>0)/4294967296}),u=function(e,t){let a=[...e];for(let e=a.length-1;e>0;e--){let s=Math.floor(t()*(e+1));[a[e],a[s]]=[a[s],a[e]]}return a}(d,c),h=Math.min(5,u.length),m=Math.min(3,h),p=h-m,x=m+(p>0?Math.floor(c()*(p+1)):0);return u.slice(0,x)})({seed:ep,role:l,country:h,level:k,subject:N,topic:A}).map((e,t)=>(0,s.jsxs)("button",{onClick:()=>{J(e)},className:"p-5 rounded-[2rem] bg-slate-50 dark:bg-white/5 border border-transparent hover:border-indigo-500/20 hover:bg-white dark:hover:bg-slate-900 text-left transition-all hover:shadow-xl group",children:[(0,s.jsxs)("div",{className:"text-[10px] font-black uppercase tracking-widest text-indigo-500 mb-2",children:["Suggestion ",t+1]}),(0,s.jsx)("p",{className:"text-[13px] font-bold text-slate-600 dark:text-slate-300 leading-relaxed group-hover:text-indigo-600 transition-colors",children:e})]},t))})]})}):(0,s.jsxs)("div",{className:"max-w-4xl mx-auto space-y-12 pb-32",children:[H.map((e,t)=>{var a,i;let r="elora"===e.from,n=null===(a=e.text)||void 0===a?void 0:a.match(/<quiz_data>([\s\S]*?)<\/quiz_data>/i),l=n?JSON.parse(n[1]):null,o=null===(i=e.text)||void 0===i?void 0:i.replace(/<quiz_data>[\s\S]*?<\/quiz_data>/gi,"").trim();return(0,s.jsx)(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:cn("flex group",r?"justify-start":"justify-end"),children:(0,s.jsxs)("div",{className:cn("max-w-[85%] sm:max-w-2xl flex gap-4 sm:gap-6",r?"flex-row":"flex-row-reverse"),children:[r&&(0,s.jsx)("div",{className:"w-10 h-10 bg-indigo-600 rounded-2xl flex items-center justify-center text-xl shadow-xl shadow-indigo-500/20 shrink-0 mt-1",children:"\uD83D\uDEF8"}),(0,s.jsxs)("div",{className:"space-y-4 min-w-0",children:[o&&(0,s.jsxs)("div",{className:cn("p-6 sm:p-8 rounded-[2.5rem] relative overflow-hidden",r?"bg-slate-50 dark:bg-white/5 border border-slate-100 dark:border-white/5 text-slate-800 dark:text-slate-100":"bg-indigo-600 text-white shadow-2xl shadow-indigo-600/20"),children:[r&&(0,s.jsx)("div",{className:"absolute top-0 right-0 p-4 opacity-0 transition-opacity",children:(0,s.jsx)("button",{onClick:()=>copyToClipboard(o,t),className:"p-2 hover:bg-slate-200 dark:hover:bg-white/10 rounded-xl transition-all",children:en===t?"✅":"\uD83D\uDCCB"})}),(0,s.jsx)("div",{className:"prose prose-slate dark:prose-invert max-w-none text-[15px] font-medium leading-[1.8] tracking-tight whitespace-pre-wrap",children:o})]}),r&&l&&(0,s.jsx)(InteractiveQuiz,{data:l,onComplete:()=>{}}),r&&t===H.length-1&&E&&f[E]&&!Q&&(0,s.jsx)("div",{className:"flex flex-wrap gap-2 pt-2",children:f[E].map(e=>(0,s.jsx)("button",{onClick:()=>applyRefinement(e.id),className:"px-4 py-2 rounded-full border border-slate-200 dark:border-white/10 bg-white dark:bg-slate-900 text-[10px] font-black uppercase tracking-widest text-slate-500 hover:text-indigo-600 transition-all",children:e.label},e.id))})]})]})},t)}),Q&&(0,s.jsx)("div",{className:"flex justify-start animate-reveal",children:(0,s.jsxs)("div",{className:"flex gap-4 sm:gap-6 max-w-2xl",children:[(0,s.jsx)("div",{className:"w-10 h-10 bg-indigo-600 rounded-2xl flex items-center justify-center text-xl shadow-xl shadow-indigo-500/20 shrink-0",children:"\uD83D\uDEF8"}),(0,s.jsxs)("div",{className:"flex items-center gap-1.5 p-6 rounded-[2.5rem] bg-slate-50 dark:bg-white/5 border border-slate-100 dark:border-white/5",children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-indigo-500 rounded-full animate-bounce"}),(0,s.jsx)("div",{className:"w-2 h-2 bg-indigo-500 rounded-full animate-bounce [animation-delay:0.2s]"}),(0,s.jsx)("div",{className:"w-2 h-2 bg-indigo-500 rounded-full animate-bounce [animation-delay:0.4s]"})]})]})})]})}),(0,s.jsxs)("div",{className:"p-6 lg:p-10 bg-gradient-to-t from-white via-white dark:from-slate-950 dark:via-slate-950 to-transparent pt-20 shrink-0 relative z-20",children:[(0,s.jsx)(AnimatePresence,{children:ec&&(0,s.jsx)(m.button,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},onClick:jumpToLatest,className:"absolute top-0 left-1/2 -translate-x-1/2 px-6 py-2.5 bg-indigo-600 text-white text-[10px] font-black uppercase tracking-widest rounded-full shadow-2xl hover:scale-105 transition-all flex items-center gap-2",children:(0,s.jsx)("span",{children:"New Message ↓"})})}),(0,s.jsxs)("div",{className:"max-w-4xl mx-auto space-y-6",children:[(0,s.jsx)(AnimatePresence,{children:eE&&(0,s.jsxs)(m.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"flex items-center gap-4 p-3 bg-slate-50 dark:bg-white/5 rounded-2xl border border-indigo-500/20 w-fit",children:[(0,s.jsx)("div",{className:"w-12 h-12 rounded-xl overflow-hidden bg-indigo-500/10 border border-white/10",children:(0,s.jsx)("img",{src:eE.dataUrl,alt:"Preview",className:"w-full h-full object-cover"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-[10px] font-black uppercase tracking-widest text-indigo-500",children:"Attachment"}),(0,s.jsx)("div",{className:"text-[11px] font-bold text-slate-500 truncate max-w-[120px]",children:eE.name})]}),(0,s.jsx)("button",{onClick:()=>eD(null),className:"p-2 hover:bg-slate-200 dark:hover:bg-white/10 rounded-xl transition-all font-black",children:"✕"})]})}),eT&&(0,s.jsxs)("div",{className:"text-[10px] font-black uppercase tracking-widest text-rose-500 ml-4 animate-reveal",children:["⚠️ ",eT]}),(0,s.jsxs)("div",{className:"relative group",children:[(0,s.jsx)("div",{className:"absolute -inset-1 bg-gradient-to-r from-indigo-500 to-purple-500 rounded-[2.5rem] blur opacity-10 group-focus-within:opacity-30 transition duration-1000"}),(0,s.jsxs)("div",{className:"relative flex items-end gap-3 p-3 bg-white dark:bg-slate-900 rounded-[2.5rem] border border-slate-100 dark:border-white/5 shadow-2xl",children:[(0,s.jsx)("div",{className:"flex flex-col gap-2 pb-1 pl-1",children:(0,s.jsxs)("label",{className:"cursor-pointer p-3 hover:bg-slate-100 dark:hover:bg-white/10 rounded-2xl transition-all text-xl",title:"Attach Image",children:["\uD83D\uDCF7",(0,s.jsx)("input",{type:"file",accept:"image/*",className:"hidden",onChange:e=>{var t;return onPickImage(null===(t=e.target.files)||void 0===t?void 0:t[0])},disabled:Q})]})}),(0,s.jsx)("textarea",{placeholder:Q?"".concat(eU," is thinking..."):"Ask ".concat(eU," anything about ").concat(A||N,"..."),value:V,onChange:e=>J(e.target.value),className:"flex-1 bg-transparent border-none focus:ring-0 p-4 min-h-[56px] max-h-48 text-[15px] font-medium placeholder:text-slate-400 custom-scrollbar resize-none",disabled:Q}),(0,s.jsx)("div",{className:"flex flex-col gap-2 pb-1 pr-1",children:(0,s.jsx)("button",{onClick:sendChat,disabled:Q||!V.trim()&&!eE,className:cn("w-12 h-12 rounded-2xl flex items-center justify-center text-xl transition-all shadow-xl",V.trim()||eE?"bg-indigo-600 text-white hover:scale-105 active:scale-95 shadow-indigo-500/40":"bg-slate-100 dark:bg-white/5 text-slate-400 cursor-not-allowed"),children:Q?"⏳":"\uD83D\uDE80"})})]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between px-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:cn("w-2 h-2 rounded-full",eL?"bg-emerald-500":"bg-amber-500 animate-pulse")}),(0,s.jsx)("span",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400",children:eL?"Neural Link Secured":"Guest Mode Active"})]}),!eL&&(0,s.jsx)(r(),{href:"/login",className:"text-[10px] font-black uppercase tracking-widest text-indigo-500 hover:text-indigo-400 transition-colors",children:"Sync Account →"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("button",{onClick:()=>void(function(e,t){let a=loadAll(),s=ensureUser(a,e);s.threads=(s.threads||[]).map(normalizeThread);let i=s.threads.find(e=>e.id===t);i&&(i.messages=[],i.title="New chat",i.updatedAt=now(),s.activeId=i.id,pruneUser(s),saveAll(a))}(G,W),X([]),persistActiveMessages([],{alsoSyncServer:!0})),className:"text-[10px] font-black uppercase tracking-widest text-slate-400 hover:text-rose-500 transition-colors",children:"Clear Path"}),(0,s.jsx)("div",{className:"h-3 w-px bg-slate-100 dark:border-white/5"}),(0,s.jsx)("div",{className:"flex gap-2",children:["docx","pptx","pdf"].map(e=>(0,s.jsx)("button",{onClick:()=>exportLast(e),className:"text-[10px] font-black uppercase tracking-widest text-slate-400 hover:text-indigo-500 transition-colors",children:e},e))})]})]}),(0,s.jsx)(AnimatePresence,{children:ei&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(m.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>er(!1),className:"fixed inset-0 bg-slate-950/20 backdrop-blur-sm z-[60]"}),(0,s.jsxs)(m.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{type:"spring",damping:25,stiffness:200},className:"fixed top-0 right-0 h-full w-full max-w-sm bg-white dark:bg-slate-900 border-l border-slate-100 dark:border-white/5 z-[61] shadow-2xl flex flex-col",children:[(0,s.jsxs)("div",{className:"p-8 border-b border-slate-100 dark:border-white/5 flex items-center justify-between",children:[(0,s.jsx)("h3",{className:"text-xl font-black italic tracking-tighter",children:"THREAD HISTORY"}),(0,s.jsx)("button",{onClick:()=>er(!1),className:"text-slate-400 hover:text-slate-900 dark:hover:text-white transition-colors",children:"✕"})]}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-2 custom-scrollbar",children:[(0,s.jsxs)("button",{onClick:()=>{(function(){if(!eL){ey(!0);return}let e="New Chat ".concat(new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})),t=function(e){let t=loadAll(),a=ensureUser(t,e);a.threads=(a.threads||[]).map(normalizeThread);let s=makeId(),i={id:s,title:"New chat",createdAt:now(),updatedAt:now(),pinned:!1,messages:[]};return a.threads.unshift(i),a.activeId=s,pruneUser(a),saveAll(t),{id:s}}(G,e);setActiveThreadAndLoad(t)})(),er(!1)},className:"w-full flex items-center justify-center gap-3 p-4 rounded-2xl bg-indigo-600 text-white font-black text-xs uppercase tracking-widest shadow-xl shadow-indigo-500/20 hover:scale-[1.02] active:scale-95 transition-all mb-4",children:[(0,s.jsx)("span",{children:"Initiate New Session"}),(0,s.jsx)("span",{children:"✨"})]}),0===O.length?(0,s.jsx)("div",{className:"text-center py-10 text-slate-400 text-xs font-bold uppercase tracking-widest opacity-40 italic",children:"No stored threads"}):O.map(e=>{let t=W===e.id;return(0,s.jsxs)("div",{className:cn("group p-4 rounded-2xl border transition-all cursor-pointer relative",t?"bg-indigo-500/10 border-indigo-500/40":"bg-white dark:bg-slate-800/50 border-transparent hover:border-slate-200 dark:hover:border-white/10"),onClick:()=>{setActiveThreadAndLoad(e.id),er(!1)},children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("span",{className:"text-lg",children:e.pinned?"\uD83D\uDCCC":"\uD83D\uDCC4"}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("h4",{className:cn("text-xs font-black truncate",t?"text-indigo-600":"text-slate-600 dark:text-slate-200"),children:e.name}),(0,s.jsx)("p",{className:"text-[9px] font-bold text-slate-400 uppercase tracking-widest mt-1",children:new Date(e.ts).toLocaleDateString([],{month:"short",day:"numeric"})})]})]}),(0,s.jsxs)("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,s.jsx)("button",{onClick:t=>{t.stopPropagation(),function(e,t){let a=loadAll(),s=ensureUser(a,e);s.threads=(s.threads||[]).map(normalizeThread);let i=s.threads.find(e=>e.id===t);i&&(i.pinned=!i.pinned,i.updatedAt=now(),pruneUser(s),saveAll(a),i.pinned)}(G,e.id),F(listThreads(G))},className:"p-1.5 hover:bg-slate-200 dark:hover:bg-white/10 rounded-lg text-[10px]",children:e.pinned?"\uD83D\uDCCD":"\uD83D\uDCCC"}),(0,s.jsx)("button",{onClick:t=>{t.stopPropagation(),ef(e.id),ev(e.name)},className:"p-1.5 hover:bg-slate-200 dark:hover:bg-white/10 rounded-lg text-[10px]",children:"✏️"}),(0,s.jsx)("button",{onClick:t=>{t.stopPropagation(),function(e){!function(e,t){let a=loadAll(),s=ensureUser(a,e);if(s.threads=(s.threads||[]).map(normalizeThread),s.threads=s.threads.filter(e=>e.id!==t),!s.threads.length){let e=makeId();s.threads=[{id:e,title:"New chat",createdAt:now(),updatedAt:now(),pinned:!1,messages:[]}],s.activeId=e}pruneUser(s),saveAll(a)}(G,e);let t=syncThreadsState(G);B(t)}(e.id)},className:"p-1.5 hover:bg-slate-200 dark:hover:bg-white/10 rounded-lg text-[10px] text-rose-500",children:"\uD83D\uDDD1️"})]})]},e.id)})]})]})]})}),(0,s.jsx)(AIResourceDrawer,{open:eA,onClose:()=>eC(!1),topic:A,subject:N}),(0,s.jsx)(Modal,{open:!!eg,onClose:()=>ef(""),title:"Rename Thread",children:(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("input",{id:"rename-input",type:"text",value:eb,onChange:e=>ev(e.target.value),className:"w-full bg-slate-50 dark:bg-slate-900 border border-slate-100 dark:border-white/5 rounded-2xl p-4 text-sm font-bold focus:ring-2 ring-indigo-500/20",onKeyDown:e=>"Enter"===e.key&&onRenameConfirm(),autoFocus:!0}),(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)("button",{onClick:()=>ef(""),className:"flex-1 py-3 rounded-xl bg-slate-100 dark:bg-white/5 text-[10px] font-black uppercase tracking-widest hover:bg-slate-200 dark:hover:bg-white/10 transition-all",children:"Cancel"}),(0,s.jsx)("button",{onClick:onRenameConfirm,className:"flex-1 py-3 rounded-xl bg-indigo-600 text-white text-[10px] font-black uppercase tracking-widest shadow-xl shadow-indigo-500/20 hover:scale-[1.02] active:scale-95 transition-all",children:"Confirm Rename"})]})]})}),(0,s.jsx)(Modal,{open:ew,onClose:()=>ey(!1),title:"Security Breach Detected",children:(0,s.jsxs)("div",{className:"text-center space-y-6 py-4",children:[(0,s.jsx)("div",{className:"w-20 h-20 bg-amber-500/10 text-amber-500 rounded-3xl flex items-center justify-center text-3xl mx-auto shadow-xl",children:"⚠️"}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("h4",{className:"text-xl font-black tracking-tight",children:"Access Restricted"}),(0,s.jsx)("p",{className:"text-xs font-medium text-slate-500 leading-relaxed px-4",children:"Advanced learning tools, cloud persistence, and high-level exports require a verified neural link (your email)."})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,s.jsx)(r(),{href:"/login",className:"py-4 rounded-2xl bg-indigo-600 text-white text-xs font-black uppercase tracking-widest shadow-xl shadow-indigo-500/20 hover:scale-[1.02] active:scale-95 transition-all no-underline",children:"Secure Connection Now"}),(0,s.jsx)("button",{onClick:()=>ey(!1),className:"py-4 text-[10px] font-black uppercase tracking-widest text-slate-400 hover:text-slate-600 transition-colors",children:"Continue in Sandbox Mode"})]})]})}),(0,s.jsx)(Modal,{open:ek,onClose:()=>ej(!1),title:"Teacher Authorization",children:(0,s.jsxs)("div",{className:"space-y-6 py-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4 p-4 bg-indigo-500/10 rounded-2xl border border-indigo-500/20",children:[(0,s.jsx)("div",{className:"text-2xl",children:"\uD83C\uDF93"}),(0,s.jsx)("p",{className:"text-[11px] font-bold text-indigo-700 dark:text-indigo-300 leading-relaxed",children:"Educator tools (Lesson Plans, Worksheets) require a verified teacher invitation code."})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400 ml-2",children:"Access Key"}),(0,s.jsx)("input",{type:"text",placeholder:"ELORA-XXXX-XXXX",className:"w-full bg-slate-50 dark:bg-slate-900 border border-slate-100 dark:border-white/5 rounded-2xl p-4 text-sm font-bold uppercase tracking-widest placeholder:text-slate-300 focus:ring-2 ring-indigo-500/20",onKeyUp:e=>{"Enter"===e.key&&validateAndActivateInvite(e.target.value).then(e=>{e&&setTimeout(()=>ej(!1),2e3)})},id:"teacher-code-input"}),eN&&(0,s.jsx)("div",{className:cn("text-[9px] font-black uppercase tracking-widest ml-2",eN.includes("✅")?"text-emerald-500":"text-rose-500"),children:eN})]}),(0,s.jsx)("button",{onClick:async()=>{let e=document.getElementById("teacher-code-input");if(e){let t=await validateAndActivateInvite(e.value);t&&setTimeout(()=>ej(!1),2e3)}},className:"w-full py-4 rounded-2xl bg-slate-900 dark:bg-white text-white dark:text-slate-900 text-xs font-black uppercase tracking-widest shadow-2xl hover:scale-[1.02] active:scale-95 transition-all",children:"Verify Credentials"}),(0,s.jsxs)("p",{className:"text-center text-[10px] font-medium text-slate-400",children:["Need a code? ",(0,s.jsx)("a",{href:"mailto:support@elora.ai",className:"text-indigo-500 font-bold",children:"Request Access"})]})]})})]})]})]})]}),!eL&&!eh&&(0,s.jsxs)(m.div,{initial:{y:100},animate:{y:0},className:"fixed bottom-6 left-1/2 -translate-x-1/2 w-[calc(100%-3rem)] max-w-xl bg-white/10 dark:bg-slate-900/10 backdrop-blur-2xl border border-white/20 p-2 pl-6 rounded-full flex items-center justify-between shadow-2xl z-50 ring-1 ring-white/10",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("span",{className:"flex w-2 h-2 rounded-full bg-amber-500 animate-pulse"}),(0,s.jsxs)("p",{className:"text-[10px] font-black text-slate-900 dark:text-white uppercase tracking-widest",children:["Limited Sandbox: ",(0,s.jsx)("span",{className:"opacity-60 font-medium",children:"Messages won't save."})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(r(),{href:"/login",className:"px-4 py-2 bg-white dark:bg-white text-slate-900 rounded-full text-[10px] font-black uppercase tracking-widest no-underline",children:"Secure Link"}),(0,s.jsx)("button",{onClick:function(){em(!0);try{window.localStorage.setItem(v,"true")}catch(e){}},className:"p-2 text-slate-400 hover:text-white transition-opacity",children:"✕"})]})]})]}):(0,s.jsx)("div",{className:"min-h-screen bg-slate-950"})}}},function(e){e.O(0,[675,774,888,179],function(){return e(e.s=5973)}),_N_E=e.O()}]);