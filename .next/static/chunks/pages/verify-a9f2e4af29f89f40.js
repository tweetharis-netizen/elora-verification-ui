(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[143],{8623:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/verify",function(){return a(6166)}])},6166:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return VerifyPage}});var r=a(5893),i=a(7294),n=a(1163),s=a(3495);function VerifyPage(){let e=(0,n.useRouter)(),t=(0,i.useMemo)(()=>"string"==typeof e.query.error?e.query.error:"",[e.query.error]),a=(0,i.useMemo)(()=>"string"==typeof e.query.token?e.query.token:"",[e.query.token]),[o,l]=(0,i.useState)(""),[c,u]=(0,i.useState)(!1),[d,m]=(0,i.useState)(""),[f,h]=(0,i.useState)(0);async function send(){m("");let e=o.trim();if(!/^\S+@\S+\.\S+$/.test(e)){m("Enter a valid email address.");return}if(!(f>0)){u(!0);try{let t=await fetch("/api/verification/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})}),a=await t.json().catch(()=>null);if(!t.ok||!(null==a?void 0:a.ok)){if((null==a?void 0:a.error)==="rate_limited"){let e=Number((null==a?void 0:a.retryAfter)||30);h(Number.isFinite(e)?Math.min(120,Math.max(10,e)):30),m("Please wait a moment before trying again.")}else m("Could not send verification email. Please try again.");return}h(30),m("Sent. Check your inbox (and spam) for a verification link.")}catch(e){m("Could not reach the server. Please try again.")}finally{u(!1)}}}return(0,i.useEffect)(()=>{if(!e.isReady||(e.query.redirect&&localStorage.setItem("elora_redirect",String(e.query.redirect)),!a))return;let t=localStorage.getItem("elora_redirect"),r=t?"&redirect=".concat(encodeURIComponent(t)):"";localStorage.removeItem("elora_redirect"),window.location.href="/api/verification/confirm?token=".concat(encodeURIComponent(a)).concat(r)},[e.isReady,a,e.query.redirect]),(0,i.useEffect)(()=>{let e=function(e){switch(e){case"rate_limited":return"Too many attempts. Please wait a moment and try again.";case"smtp_auth_failed":return"Email service is temporarily unavailable. Try again soon.";case"invalid":return"That verification link is invalid.";case"expired":return"That verification link expired. Send a new one.";case"backend_unreachable":return"Server is unreachable. Please try again.";default:return e?"Something went wrong. Please try again.":""}}(t);e&&m(e)},[t]),(0,i.useEffect)(()=>{if(f<=0)return;let e=setInterval(()=>h(e=>Math.max(0,e-1)),1e3);return()=>clearInterval(e)},[f]),(0,r.jsx)("div",{className:"mx-auto max-w-3xl px-4 flex items-center justify-center min-h-[80vh]",children:(0,r.jsxs)(s.E.div,{initial:{opacity:0,scale:.95,y:10},animate:{opacity:1,scale:1,y:0},transition:{duration:.5,ease:"easeOut"},className:"elora-card p-6 sm:p-8 w-full relative overflow-hidden",children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-500/5 via-transparent to-transparent pointer-events-none"}),(0,r.jsxs)("div",{className:"relative z-10",children:[(0,r.jsx)("h1",{className:"font-black text-[clamp(22px,3vw,30px)]",children:"Verify your email"}),(0,r.jsx)("p",{className:"mt-2 elora-muted",children:"Verification unlocks full teacher workflows (exports, assessments, and more). It persists across refreshes."}),(0,r.jsxs)("div",{className:"mt-6 grid gap-3",children:[(0,r.jsx)("input",{className:"elora-input",value:o,onChange:e=>l(e.target.value),placeholder:"you@example.com",inputMode:"email",autoComplete:"email"}),(0,r.jsxs)(s.E.button,{whileHover:{scale:1.01},whileTap:{scale:.99},type:"button",className:"elora-btn relative overflow-hidden",onClick:send,disabled:c||f>0,children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent translate-x-[-100%] hover:translate-x-[100%] transition-transform duration-1000"}),c?"Sending…":f>0?"Wait ".concat(f,"s"):"Send verification email"]}),d?(0,r.jsx)(s.E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"elora-toast",children:d}):null,(0,r.jsx)("div",{className:"elora-muted text-sm",children:"Tip: If you don’t see it, check spam/junk. The link expires in under an hour."})]})]})]})})}}},function(e){e.O(0,[774,888,179],function(){return e(e.s=8623)}),_N_E=e.O()}]);